# Полное отключение всех встроенных правил
MAKEFLAGS += --no-builtin-rules --no-builtin-variables
.SUFFIXES:

# Явное объявление всех переменных
CXX := g++
CXXFLAGS := -std=c++20 -Wall -Wextra
COVERAGE_FLAGS := --coverage
GTEST_LIBS := -lgtest -lgtest_main -pthread

.PHONY: all app run-tests clean

all: app

app:
	g++ -std=c++20 -Wall -Wextra -o student_app main.cpp database.cpp

# Уникальное имя target'а с дефисом (встроенных правил для таких имен нет)
run-tests:
	g++ -std=c++20 -Wall -Wextra --coverage -o test_runner test.cpp database.cpp -lgtest -lgtest_main -pthread
	./test_runner

clean:
	rm -f student_app test_runner *.gcno *.gcda

# Явно блокируем встроенное правило для test
test.cpp:
	@echo "Blocking implicit rule for test.cpp"

# Дополнительная защита - если Make все еще пытается использовать встроенные правила
%: %.cpp
	@echo "Blocked implicit compilation rule for $@"
	@false

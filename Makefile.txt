# Переменные компилятора
CXX = g++
# Флаги компиляции, включая --coverage для отчетов
CXXFLAGS = -std=c++20 -Wall -Wextra --coverage
# Флаги компоновщика для линковки с библиотеками gtest и pthread
LDFLAGS = -lgtest -lgtest_main -pthread

# Исполняемые файлы
MAIN_APP = student_app
TEST_RUNNER = test_runner

# Исходные файлы
SOURCES = main.cpp database.cpp
TEST_SOURCES = test.cpp database.cpp

# .PHONY указывает цели, которые не являются реальными файлами
.PHONY: all clean test

# Цель по умолчанию
all: $(MAIN_APP)

# Правило для сборки основного приложения
$(MAIN_APP): $(SOURCES)
	$(CXX) $(CXXFLAGS) -o $(MAIN_APP) $(SOURCES)

# Правило для сборки и запуска тестов
test: $(TEST_RUNNER)
	./$(TEST_RUNNER)

# Правило для сборки исполняемого файла тестов.
# Здесь мы явно компилируем все нужные исходники и добавляем флаги линковки.
$(TEST_RUNNER): $(TEST_SOURCES)
	$(CXX) $(CXXFLAGS) -o $(TEST_RUNNER) $(TEST_SOURCES) $(LDFLAGS)

# Очистка
clean:
	rm -f $(MAIN_APP) $(TEST_RUNNER) *.o *.gcno *.gcda
